{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file://D%3A/front_end/projects/next_js/smart-finshing/app/projects/%5Bid%5D/page.tsx"],"sourcesContent":["// app/projects/[id]/page.tsx\r\n\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport { useApi } from \"../../context/ApiContext\";\r\nimport { useToken } from \"../../context/token_context\";\r\nimport Image from \"next/image\";\r\nimport { Pencil } from \"lucide-react\";\r\n\r\n\r\ntype ProjectImage = {\r\n  id: number;\r\n  imageUrl: string;\r\n};\r\n\r\ntype Project = {\r\n  id: number;\r\n  name: string;\r\n  serviceId: number;\r\n  serviceName: string;\r\n  apartmentType: string;\r\n  apartmentSize: string;\r\n  preferredStyle: string;\r\n  materialQuality: string;\r\n  minBudget: number;\r\n  maxBudget: number;\r\n  details: string;\r\n  createdDate: string;\r\n  projectImages: ProjectImage[];\r\n};\r\n\r\nexport default function ProjectDetailsPage() {\r\n  const [project, setProject] = useState<Project | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(\"\");\r\n  const [selectedFiles, setSelectedFiles] = useState<FileList | null>(null);\r\n  const [message, setMessage] = useState<{ type: \"success\" | \"error\"; text: string } | null>(null);\r\n\r\n  const { baseUrl } = useApi();\r\n  const { userData } = useToken();\r\n  const { id } = useParams();\r\n  const router = useRouter();\r\n\r\n  const userRole =\r\n    userData?.[\"http://schemas.microsoft.com/ws/2008/06/identity/claims/role\"] || \"\";\r\n  const isOwner = userRole.toLowerCase() === \"customer\";\r\n\r\nconst [uploading, setUploading] = useState(false);\r\n\r\n\r\n\r\nconst handleDeleteImage = async (imageId: number) => {\r\n  if (!confirm(\"Are you sure you want to delete this image?\")) return;\r\n\r\n  try {\r\n    const token = localStorage.getItem(\"token\");\r\n\r\n    const res = await fetch(\r\n      `${baseUrl}/api/Projects/${id}/images/${imageId}`,\r\n      {\r\n        method: \"DELETE\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      }\r\n    );\r\n\r\n    if (!res.ok) throw new Error(\"Failed to delete image\");\r\n\r\n    // إعادة تحميل المشروع بعد الحذف\r\n    const updated = await fetch(`${baseUrl}/api/Projects/${id}`, {\r\n      headers: { Authorization: `Bearer ${token}` },\r\n    });\r\n    const data = await updated.json();\r\n    setProject(data);\r\n  } catch (err) {\r\n    setMessage({ type: \"error\", text: \"Failed to delete image: \" + err });\r\n  }\r\n};\r\n\r\n  const fetchProject = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n\r\n      const res = await fetch(`${baseUrl}/api/Projects/${id}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n\r\n      if (!res.ok) throw new Error(`Error: ${res.status}`);\r\n\r\n      const data = await res.json();\r\n      setProject(data);\r\n    } catch (err: any) {\r\n      setError(err.message || \"Something went wrong.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchProject();\r\n  }, [baseUrl, id]);\r\n\r\n  const handleDelete = async () => {\r\n    if (!confirm(\"Are you sure you want to delete this project?\")) return;\r\n\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n\r\n      const res = await fetch(`${baseUrl}/api/Projects/${id}`, {\r\n        method: \"DELETE\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n\r\n      if (!res.ok) throw new Error(\"Failed to delete project\");\r\n\r\n      setMessage({ type: \"success\", text: \"Project deleted successfully\" });\r\n      setTimeout(() => router.push(\"/projects\"), 1200);\r\n    } catch (err: any) {\r\n      setMessage({ type: \"error\", text: \"Error deleting project: \" + err.message });\r\n    }\r\n  };\r\n\r\n  const handleUploadImages = async () => {\r\n    if (!selectedFiles) {\r\n      setMessage({ type: \"error\", text: \"Please select image(s) first.\" });\r\n      return;\r\n    }\r\n\r\n    const formData = new FormData();\r\n    for (let i = 0; i < selectedFiles.length; i++) {\r\n      formData.append(\"files\", selectedFiles[i]);\r\n    }\r\n\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const res = await fetch(`${baseUrl}/api/Projects/${id}/images`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n        body: formData,\r\n      });\r\n\r\n      if (!res.ok) throw new Error(\"Failed to upload images\");\r\n\r\n      const updatedProject = await res.json();\r\n      setProject(updatedProject);\r\n      setSelectedFiles(null);\r\n      setMessage({ type: \"success\", text: \"Images uploaded successfully!\" });\r\n    } catch (err: any) {\r\n      setMessage({ type: \"error\", text: \"Error uploading images: \" + err.message });\r\n    }\r\n  };\r\n\r\n  if (loading)\r\n      return (\r\n        <div className=\"flex justify-center items-center py-20\">\r\n          <div className=\"animate-spin rounded-full h-16 w-16 border-t-4 border-green-600 border-dashed\"></div>\r\n        </div>\r\n      );\r\n  if (error)\r\n    return (\r\n      <p className=\"text-center mt-10 text-red-600\">\r\n        Failed to load project: {error}\r\n      </p>\r\n    );\r\n  if (!project) return <p className=\"text-center mt-10\">Project not found.</p>;\r\n\r\n  return (<>\r\n    <Navbar />\r\n    <div className=\"p-6 max-w-6xl mx-auto relative\">\r\n      {/* رسائل التنبيه */}\r\n      {message && (\r\n        <div\r\n          className={`mb-6 px-4 py-3 rounded text-center font-semibold transition ${\r\n            message.type === \"success\"\r\n              ? \"bg-green-100 text-green-700 border border-green-300\"\r\n              : \"bg-red-100 text-red-700 border border-red-300\"\r\n          }`}\r\n        >\r\n          {message.text}\r\n        </div>\r\n      )}\r\n      {/* أزرار التعديل والحذف */}\r\n      {isOwner && (\r\n        <div className=\"flex gap-4 absolute top-6 right-6 z-10\">\r\n          <button\r\n            onClick={() => router.push(`/projects/${project.id}/edit`)}\r\n            className=\"bg-gray-100 hover:bg-gray-200 text-gray-700 p-2 rounded-full shadow transition\"\r\n            title=\"Edit Project\"\r\n          >\r\n            <Pencil size={20} />\r\n          </button>\r\n          <button\r\n            onClick={handleDelete}\r\n            className=\"bg-red-600 text-white px-4 py-1 rounded shadow hover:bg-red-700 transition\"\r\n          >\r\n            Delete\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      <h1 className=\"text-3xl font-bold mb-8 text-gray-800 border-b pb-4\">\r\n        Project: {project.name}\r\n      </h1>\r\n\r\n      <div className=\"flex flex-col md:flex-row gap-10\">\r\n        {/* التفاصيل */}\r\n        <div className=\"flex-1 space-y-4 bg-white rounded-xl shadow p-6\">\r\n          <div className=\"grid grid-cols-2 gap-x-4 gap-y-2\">\r\n            <p><span className=\"font-semibold text-gray-600\">Service:</span> {project.serviceName}</p>\r\n            <p><span className=\"font-semibold text-gray-600\">Apartment Type:</span> {project.apartmentType}</p>\r\n            <p><span className=\"font-semibold text-gray-600\">Size:</span> {project.apartmentSize}</p>\r\n            <p><span className=\"font-semibold text-gray-600\">Style:</span> {project.preferredStyle}</p>\r\n            <p><span className=\"font-semibold text-gray-600\">Quality:</span> {project.materialQuality}</p>\r\n            <p><span className=\"font-semibold text-gray-600\">Budget:</span> {project.minBudget} - {project.maxBudget} EGP</p>\r\n            <p className=\"col-span-2\"><span className=\"font-semibold text-gray-600\">Details:</span> {project.details}</p>\r\n            <p><span className=\"font-semibold text-gray-600\">Date:</span> {new Date(project.createdDate).toLocaleDateString()}</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* الصور ورفع صور جديدة */}\r\n        <div className=\"w-full md:w-1/2\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <span className=\"font-semibold text-gray-700\">Images ({project.projectImages.length})</span>\r\n          </div>\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            {project.projectImages.map((img) => (\r\n              <div key={img.id} className=\"relative group rounded-xl overflow-hidden shadow hover:shadow-lg transition\">\r\n                <Image\r\n                  src={img.imageUrl}\r\n                  alt=\"Project Image\"\r\n                  width={300}\r\n                  height={200}\r\n                  className=\"object-cover w-full h-40\"\r\n                />\r\n                {isOwner && (\r\n                  <button\r\n                    onClick={() => handleDeleteImage(img.id)}\r\n                    className=\"absolute top-2 right-2 bg-red-600 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition\"\r\n                  >\r\n                    Delete\r\n                  </button>\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          {/* رفع الصور لصاحب المشروع فقط */}\r\n          {isOwner && (\r\n            <div className=\"mt-6 space-y-2 bg-gray-50 rounded-xl p-4 shadow\">\r\n              <input\r\n                type=\"file\"\r\n                multiple\r\n                accept=\"image/*\"\r\n                onChange={(e) => setSelectedFiles(e.target.files)}\r\n                className=\"block w-full text-sm text-gray-600\"\r\n              />\r\n              <button\r\n                onClick={handleUploadImages}\r\n                disabled={uploading}\r\n                className={`w-full ${\r\n                  uploading ? \"bg-gray-400\" : \"bg-blue-600 hover:bg-blue-700\"\r\n                } text-white px-4 py-2 rounded transition`}\r\n              >\r\n                {uploading ? \"Uploading...\" : \"Upload Images\"}\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </>);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 543, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}