{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 143, "column": 0}, "map": {"version":3,"sources":["file://D%3A/front_end/projects/next_js/smart-finshing/app/context/token_context.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState, useRef } from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\nimport { HubConnectionBuilder, LogLevel } from \"@microsoft/signalr\";\r\nimport { useLoginClient } from \"../../context/regester/login_context\";\r\nimport { useApi } from \"../../context/ApiContext\";\r\nimport jwtDecode from \"jwt-decode\";\r\nimport axios from \"axios\";\r\n\r\ntype Message = {\r\n  id: number;\r\n  requestId: number;\r\n  senderId: number;\r\n  senderName: string;\r\n  receiverId: number;\r\n  receiverName: string;\r\n  content: string;\r\n  sentAt: string;\r\n  isRead: boolean;\r\n};\r\n\r\nexport default function ChatPage() {\r\n  const { id } = useParams(); // requestId from URL\r\n  const requestId = parseInt(id as string, 10);\r\n  const { saveData, token } = useLoginClient();\r\n  const { baseUrl } = useApi();\r\n\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [participants, setParticipants] = useState<{ workerId: number; customerId: number }>({ workerId: 0, customerId: 0 });\r\n  const [newMessage, setNewMessage] = useState(\"\");\r\n  const [connection, setConnection] = useState<any>(null);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n  // ✅ استخراج userId من التوكن\r\n  let currentUserId = 0;\r\n  if (token) {\r\n    const decodedToken: any = jwtDecode(token);\r\n    currentUserId = parseInt(decodedToken[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\"]);\r\n  }\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!token || !requestId) return;\r\n\r\n    const fetchInitialData = async () => {\r\n      try {\r\n        const [msgRes, partRes] = await Promise.all([\r\n          axios.get(`${baseUrl}/api/Chat/request/${requestId}`, {\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          }),\r\n          axios.get(`${baseUrl}/api/Chat/participants/${requestId}`, {\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          }),\r\n        ]);\r\n\r\n        setMessages(msgRes.data);\r\n        setParticipants(partRes.data);\r\n        scrollToBottom();\r\n      } catch (err) {\r\n        console.error(\"Error fetching chat data:\", err);\r\n      }\r\n    };\r\n\r\n    fetchInitialData();\r\n\r\n    const newConnection = new HubConnectionBuilder()\r\n      .withUrl(`${baseUrl}/chatHub`, {\r\n        accessTokenFactory: () => token!,\r\n      })\r\n      .configureLogging(LogLevel.Information)\r\n      .withAutomaticReconnect()\r\n      .build();\r\n\r\n    setConnection(newConnection);\r\n  }, [requestId, token]);\r\n\r\n  useEffect(() => {\r\n    if (!connection) return;\r\n\r\n    connection.start().then(async () => {\r\n      await connection.invoke(\"JoinRequestChat\", requestId);\r\n      connection.on(\"ReceiveMessage\", (msg: Message) => {\r\n        setMessages((prev) => [...prev, msg]);\r\n        scrollToBottom();\r\n      });\r\n    }).catch((err) => {\r\n      console.error(\"SignalR connection error:\", err);\r\n    });\r\n\r\n    return () => {\r\n      connection.stop();\r\n    };\r\n  }, [connection]);\r\n\r\n  const handleSend = async () => {\r\n    if (!newMessage.trim() || !currentUserId || !participants) return;\r\n\r\n    const receiverId =\r\n      currentUserId === participants.workerId\r\n        ? participants.customerId\r\n        : participants.workerId;\r\n\r\n    try {\r\n      await connection.invoke(\"SendMessage\", requestId, currentUserId, receiverId, newMessage);\r\n      setNewMessage(\"\");\r\n    } catch (err) {\r\n      console.error(\"Error sending message:\", err);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-3xl mx-auto p-4\">\r\n      <h2 className=\"text-xl font-bold mb-4\">Chat</h2>\r\n\r\n      <div className=\"h-[70vh] overflow-y-auto border rounded-lg shadow p-4 bg-gray-50\">\r\n        {messages.map((msg) => {\r\n          const isMe = msg.senderId === currentUserId;\r\n          return (\r\n            <div key={msg.id} className={`flex mb-3 ${isMe ? \"justify-end\" : \"justify-start\"}`}>\r\n              <div\r\n                className={`max-w-[75%] rounded-xl px-4 py-2 ${\r\n                  isMe\r\n                    ? \"bg-green-100 text-black rounded-br-none\"\r\n                    : \"bg-white border text-black rounded-bl-none\"\r\n                }`}\r\n              >\r\n                <p className=\"text-sm break-words\">{msg.content}</p>\r\n                <p className=\"text-xs text-gray-500 text-right mt-1\">\r\n                  {new Date(msg.sentAt).toLocaleTimeString([], {\r\n                    hour: \"2-digit\",\r\n                    minute: \"2-digit\",\r\n                  })}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      <div className=\"flex items-center mt-4 border rounded-full px-3 py-2 shadow bg-white\">\r\n        <input\r\n          type=\"text\"\r\n          value={newMessage}\r\n          onChange={(e) => setNewMessage(e.target.value)}\r\n          className=\"flex-1 outline-none border-none\"\r\n          placeholder=\"Type your message...\"\r\n        />\r\n        <button onClick={handleSend} className=\"ml-2 text-green-600 hover:text-green-800\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 rotate-45\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path d=\"M2 21l21-9L2 3v7l15 2-15 2v7z\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 375, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 381, "column": 0}, "map": {"version":3,"sources":["file://D%3A/front_end/projects/next_js/smart-finshing/app/context/ApiContext.tsx"],"sourcesContent":["\"use client\";\r\nimport React, { createContext, useContext } from \"react\";\r\n\r\nconst ApiContext = createContext();\r\n\r\nexport const ApiProvider = ({ children }) => {\r\n    const baseUrl = \"https://projectapi-ekhpcndsdgbahqhm.canadacentral-01.azurewebsites.net\";\r\n\r\n    return (\r\n        <ApiContext.Provider value={{ baseUrl }}>\r\n        {children}\r\n        </ApiContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useApi = () => useContext(ApiContext);\r\n"],"names":[],"mappings":";;;;;AACA;AADA;;;AAGA,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,gBAAa,AAAD;AAExB,MAAM,cAAc,CAAC,EAAE,QAAQ,EAAE;IACpC,MAAM,UAAU;IAEhB,qBACI,8OAAC,WAAW,QAAQ;QAAC,OAAO;YAAE;QAAQ;kBACrC;;;;;;AAGT;AAEO,MAAM,SAAS,IAAM,CAAA,GAAA,qMAAA,CAAA,aAAU,AAAD,EAAE"}},
    {"offset": {"line": 405, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 411, "column": 0}, "map": {"version":3,"sources":["file://D%3A/front_end/projects/next_js/smart-finshing/app/context/regester/signupclient_context.tsx"],"sourcesContent":["\"use client\";\r\nimport React, { createContext, useContext, useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useToken } from \"../token_context\";\r\nimport { useApi } from \"../ApiContext\"; // Assuming you have a token context to manage user data\r\n\r\nconst SignUpClientContext = createContext();\r\n // Assuming you have a base URL context\r\n\r\nexport function SignUpClientProvider({ children }) {\r\n  const { saveUserData } = useToken();\r\n  const { baseUrl } = useApi();\r\n  const [error, setError] = useState(\"\");\r\n  const [cities, setCities] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [user, setUser] = useState({\r\n    name: \"\",\r\n    email: \"\",\r\n    password: \"\",\r\n    confirmPassword: \"\",\r\n    phoneNumber: \"\",\r\n    address: \"\",\r\n    buildingNumber: \"\",\r\n    cityId: \"\",\r\n    age: \"\",\r\n    profilePicture: null,\r\n  });\r\n\r\n  useEffect(() => {\r\n    axios\r\n      .get(`${baseUrl}/api/Cities`)\r\n      .then((res) => setCities(res.data))\r\n      .catch((err) => console.error(err));\r\n  }, []);\r\n\r\n  function getUserData(e) {\r\n    const { name, value, files } = e.target;\r\n    if (name === \"profilePicture\") {\r\n      setUser((prev) => ({ ...prev, profilePicture: files[0] }));\r\n    } else {\r\n      setUser((prev) => ({ ...prev, [name]: value }));\r\n    }\r\n  }\r\n\r\n  async function sendData() {\r\n    const formData = new FormData();\r\n    formData.append(\"Name\", user.name);\r\n    formData.append(\"Email\", user.email);\r\n    formData.append(\"Password\", user.password);\r\n    formData.append(\"ConfirmPassword\", user.confirmPassword);\r\n    formData.append(\"PhoneNumber\", user.phoneNumber);\r\n    formData.append(\"Address\", user.address);\r\n    formData.append(\"BuildingNumber\", user.buildingNumber);\r\n    formData.append(\"CityId\", user.cityId);\r\n    if (user.age) formData.append(\"Age\", user.age);\r\n    if (user.profilePicture) formData.append(\"ProfilePicture\", user.profilePicture);\r\n\r\n    const { data } = await axios.post(\r\n      `${baseUrl}/api/account/register/customer`,\r\n      formData,\r\n      {\r\n        headers: {\r\n          \"Content-Type\": \"multipart/form-data\",\r\n        },\r\n        validateStatus: () => true,\r\n      }\r\n    );\r\n\r\n    if (data.errors == null) {\r\n      setIsLoading(false);\r\n      localStorage.setItem(\"token\", data.token);\r\n      localStorage.setItem(\"userData\", JSON.stringify(data));\r\n      saveUserData();\r\n      window.location.href = \"/\";\r\n    } else {\r\n      setIsLoading(false);\r\n      setError(data.errors);\r\n    }\r\n  }\r\n\r\n  function submitForm(e) {\r\n    e.preventDefault();\r\n    setIsLoading(true);\r\n    sendData();\r\n  }\r\n\r\n  return (\r\n    <SignUpClientContext.Provider\r\n      value={{\r\n        error,\r\n        cities,\r\n        isLoading,\r\n        user,\r\n        getUserData,\r\n        submitForm,\r\n      }}\r\n    >\r\n      {children}\r\n    </SignUpClientContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useSignUpClient() {\r\n  const context = useContext(SignUpClientContext);\r\n  if (!context) {\r\n    throw new Error(\"useSignUpClient must be used within a SignUpClientProvider\");\r\n  }\r\n  return context;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 519, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 525, "column": 0}, "map": {"version":3,"sources":["file://D%3A/front_end/projects/next_js/smart-finshing/app/context/regester/login_context.tsx"],"sourcesContent":["\"use client\";\r\nimport React, { createContext, useContext, useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useToken } from \"../token_context\";\r\nimport { useApi } from \"../ApiContext\"; // Assuming you have a token context to manage user data\r\n\r\nconst LoginClientContext = createContext();\r\n\r\nexport function LoginClientProvider({ children }) {\r\n  const { saveUserData } = useToken();\r\n  const [error, setErrors] = useState(\"\");\r\n  const [isLoading, setisLoading] = useState(false);\r\n  const [saveData, setSaveData] = useState(null);     // بيانات المستخدم\r\n  const [token, setToken] = useState(null);           // التوكن فقط\r\n  const { baseUrl } = useApi(); // Assuming you have a base URL context\r\n\r\n  const [user, setUser] = useState({\r\n      email: \"\",\r\n      password: \"\",\r\n  });\r\n\r\n  // تحميل التوكن و userData من localStorage بعد الريفرش\r\n  useEffect(() => {\r\n      const storedUserData = localStorage.getItem(\"userData\");\r\n      const storedToken = localStorage.getItem(\"token\");\r\n\r\n      if (storedUserData) setSaveData(JSON.parse(storedUserData));\r\n      if (storedToken) setToken(storedToken);\r\n  }, []);\r\n\r\n  function getUserData(eventInfo) {\r\n      const updated = { ...user, [eventInfo.target.name]: eventInfo.target.value };\r\n      setUser(updated);\r\n  }\r\n\r\n  async function sendData() {\r\n      try {\r\n      const { data } = await axios.post(\r\n          `${baseUrl}/api/account/login`,\r\n          user,\r\n          { validateStatus: () => true }\r\n      );\r\n\r\n      if (data.errors == null) {\r\n          setisLoading(false);\r\n          localStorage.setItem(\"token\", data.token);\r\n          setSaveData(data);\r\n          localStorage.setItem(\"userData\", JSON.stringify(data));\r\n          setToken(data.token);\r\n          saveUserData(); // تحديث بيانات المستخدم في السياق\r\n\r\n          window.location.href = \"/\";\r\n      } else {\r\n          setisLoading(false);\r\n          setErrors(data.errors);\r\n      }\r\n      } catch (error) {\r\n      setisLoading(false);\r\n      setErrors(\"فشل الاتصال بالخادم.\");\r\n      }\r\n  }\r\n\r\n  function submitForm(e) {\r\n      e.preventDefault();\r\n      setisLoading(true);\r\n      sendData();\r\n  }\r\n\r\n  async function updateProfilePicture(file) {\r\n  const token = localStorage.getItem(\"token\");\r\n  if (!token) {\r\n      throw new Error(\"لم يتم العثور على التوكن، يرجى تسجيل الدخول مجددًا.\");\r\n  }\r\n\r\n  try {\r\n      const formData = new FormData();\r\n      formData.append(\"newProfilePicture\", file);\r\n\r\n      const response = await fetch(\r\n      `${baseUrl}/api/Account/update-profile-picture`,\r\n      {\r\n          method: \"PUT\",\r\n          headers: {\r\n          Authorization: `Bearer ${token}`,\r\n          },\r\n          body: formData,\r\n      }\r\n      );\r\n\r\n      if (!response.ok) {\r\n      const result = await response.json();\r\n      throw new Error(result.message || \"فشل رفع الصورة\");\r\n      }\r\n\r\n      const newUrl = await response.text(); // السيرفر بيرجع رابط الصورة كنص\r\n\r\n      const oldDataRaw = localStorage.getItem(\"userData\");\r\n      if (!oldDataRaw) throw new Error(\"بيانات المستخدم غير موجودة\");\r\n\r\n      const oldData = JSON.parse(oldDataRaw);\r\n      const updatedData = { ...oldData, profilePictureUrl: newUrl };\r\n\r\n      localStorage.setItem(\"userData\", JSON.stringify(updatedData));\r\n      setSaveData(updatedData);\r\n\r\n      return newUrl;\r\n  } catch (error) {\r\n      console.error(\"فشل رفع الصورة:\", error);\r\n      throw error;\r\n  }\r\n  }\r\n  \r\n  async function updateAccountInfo(updatedFields) {\r\n    const token = localStorage.getItem(\"token\");\r\n    if (!token) throw new Error(\"لم يتم العثور على التوكن\");\r\n\r\n    try {\r\n      const response = await fetch(\r\n        `${baseUrl}/api/Account/update`,\r\n        {\r\n          method: \"PUT\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `Bearer ${token}`,\r\n          },\r\n          body: JSON.stringify(updatedFields),\r\n        }\r\n      );\r\n\r\n      if (!response.ok) {\r\n        const text = await response.text();\r\n        let result = {};\r\n        try {\r\n          result = JSON.parse(text);\r\n        } catch {\r\n          result.message = text || \"فشل التحديث\";\r\n        }\r\n        throw new Error(result.message || \"فشل التحديث\");\r\n      }\r\n\r\n      // ✅ نجيب اسم المدينة\r\n      let cityName = \"\";\r\n      try {\r\n        const cityRes = await fetch(`${baseUrl}/api/Cities`);\r\n        const cityList = await cityRes.json();\r\n        const foundCity = Array.isArray(cityList)\r\n          ? cityList.find((c) => c.id === updatedFields.cityId)\r\n          : null;\r\n\r\n        cityName = foundCity?.name || \"\";\r\n      } catch (err) {\r\n        console.warn(\"فشل في جلب اسم المدينة:\", err);\r\n      }\r\n\r\n      // ✅ نحدث userData يدويًا\r\n      const oldDataRaw = localStorage.getItem(\"userData\");\r\n      const oldData = oldDataRaw ? JSON.parse(oldDataRaw) : {};\r\n\r\n      const updatedUserData = {\r\n        ...oldData,\r\n        displayName: updatedFields.name || oldData.displayName,\r\n        phoneNumber: updatedFields.phoneNumber || oldData.phoneNumber,\r\n        address: updatedFields.address || oldData.address,\r\n        buildingNumber: updatedFields.buildingNumber || oldData.buildingNumber,\r\n        cityId: updatedFields.cityId || oldData.cityId,\r\n        cityName: cityName || oldData.cityName,\r\n        age: updatedFields.age || oldData.age,\r\n        description: updatedFields.description || oldData.description,\r\n        companyName: updatedFields.companyName || oldData.companyName,\r\n        experienceYears: updatedFields.experienceYears || oldData.experienceYears,\r\n        serviceId: updatedFields.serviceId || oldData.serviceId,\r\n      };\r\n\r\n      localStorage.setItem(\"userData\", JSON.stringify(updatedUserData));\r\n      setSaveData(updatedUserData);\r\n\r\n      return updatedUserData;\r\n    } catch (error) {\r\n      console.error(\"فشل التحديث:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async function changePassword({ currentPassword, newPassword, confirmPassword }) {\r\n  const token = localStorage.getItem(\"token\");\r\n  if (!token) throw new Error(\"يجب تسجيل الدخول أولاً\");\r\n\r\n  try {\r\n    const response = await fetch(\r\n      `${baseUrl}/api/Account/change-password`,\r\n      {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n        body: JSON.stringify({ currentPassword, newPassword, confirmPassword }),\r\n      }\r\n    );\r\n\r\n    const result = await response.json();\r\n\r\n    if (!response.ok || result.errors) {\r\n      const errorMessage = result.errors?.[0] || result.message || \"فشل تغيير كلمة المرور.\";\r\n      throw new Error(errorMessage);\r\n    }\r\n\r\n    return result;\r\n  } catch (error) {\r\n    console.error(\"فشل تغيير كلمة المرور:\", error);\r\n    throw error;\r\n  }\r\n}\r\n\r\nasync function deleteAccount() {\r\n  const token = localStorage.getItem(\"token\");\r\n  if (!token) throw new Error(\"لم يتم العثور على التوكن\");\r\n\r\n  try {\r\n    const response = await fetch(\r\n      `${baseUrl}/api/Account/deleteAccount`,\r\n      {\r\n        method: \"DELETE\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      const result = await response.text();\r\n      throw new Error(result || \"فشل حذف الحساب\");\r\n    }\r\n\r\n    // حذف البيانات من localStorage وتوجيه المستخدم للخروج\r\n    localStorage.removeItem(\"userData\");\r\n    localStorage.removeItem(\"token\");\r\n    window.location.href = \"/login\"; // عدل على حسب صفحة تسجيل الدخول\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"Delete account error:\", error);\r\n    return { success: false, message: error.message };\r\n  }\r\n}\r\n\r\nasync function deleteProfilePicture() {\r\n  const token = localStorage.getItem(\"token\");\r\n  if (!token) throw new Error(\"لم يتم العثور على التوكن\");\r\n\r\n  try {\r\n    const response = await fetch(\r\n      `${baseUrl}/api/Account/delete-profile-picture`,\r\n      {\r\n        method: \"DELETE\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      const result = await response.text();\r\n      throw new Error(result || \"فشل حذف الصورة\");\r\n    }\r\n\r\n    // تحديث بيانات المستخدم بعد حذف الصورة\r\n    const oldDataRaw = localStorage.getItem(\"userData\");\r\n    if (oldDataRaw) {\r\n      const oldData = JSON.parse(oldDataRaw);\r\n      const updatedData = { ...oldData, profilePictureUrl: null };\r\n      localStorage.setItem(\"userData\", JSON.stringify(updatedData));\r\n      setSaveData(updatedData);\r\n    }\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"فشل حذف الصورة:\", error);\r\n    return { success: false, message: error.message };\r\n  }\r\n}\r\n\r\n\r\n\r\n    return (\r\n        <LoginClientContext.Provider\r\n        value={{\r\n            error,\r\n            isLoading,\r\n            getUserData,\r\n            submitForm,\r\n            saveData,\r\n            token,\r\n            updateProfilePicture,\r\n            updateAccountInfo,\r\n            changePassword,\r\n            deleteAccount,\r\n            deleteProfilePicture,\r\n        }}\r\n        >\r\n        {children}\r\n        </LoginClientContext.Provider>\r\n    );\r\n    }\r\n\r\n    export function useLoginClient() {\r\n    const context = useContext(LoginClientContext);\r\n    if (!context) {\r\n        throw new Error(\"useLoginClient must be used within a LoginClientProvider\");\r\n    }\r\n    return context;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 805, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 811, "column": 0}, "map": {"version":3,"sources":["file://D%3A/front_end/projects/next_js/smart-finshing/app/context/regester/signUpWorker_context.tsx"],"sourcesContent":["\"use client\";\r\nimport React, { createContext, useContext, useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useToken } from \"../token_context\";\r\nimport { useApi } from \"../ApiContext\"; // Assuming you have a token context to manage user data\r\n\r\n\r\nconst SignUpIndustrialContext = createContext();\r\n // Assuming you have a base URL context\r\nexport function SignUpIndustrialProvider({ children }) {\r\n  const { saveUserData } = useToken();\r\n  const [error, setError] = useState(null);\r\n  const [cities, setCities] = useState([]);\r\n  const [services, setServices] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { baseUrl } = useApi();\r\n  const [user, setUser] = useState({\r\n    displayName: '',\r\n    email: '',\r\n    password: '',\r\n    confirmPassword: '',\r\n    phoneNumber: '',\r\n    address: '',\r\n    buildingNumber: '',\r\n    experienceYears: 0,\r\n    cityName: '',\r\n    age: '',\r\n    profilePicture: null,\r\n    serviceName: '',\r\n    description: '',\r\n    minPrice: '',\r\n    maxPrice: '',\r\n    availableDays: [],\r\n  });\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const [citiesRes, servicesRes] = await Promise.all([\r\n          axios.get(`${baseUrl}/api/Cities`),\r\n          axios.get(`${baseUrl}/api/categories/services?pageSize=1000`),\r\n        ]);\r\n\r\n        setCities(citiesRes.data.data || citiesRes.data);\r\n\r\n        const raw = servicesRes.data.data || [];\r\n        const valid = raw.filter(service => service && service.id && service.name);\r\n        setServices(valid);\r\n      } catch (err) {\r\n        console.error(\"❌ Failed to fetch data:\", err);\r\n        setError(\"فشل في تحميل البيانات المطلوبة. حاول مرة أخرى.\");\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  function getUserData(e) {\r\n    const { name, value, files } = e.target;\r\n    if (name === \"profilePicture\") {\r\n      setUser(prev => ({ ...prev, profilePicture: files[0] }));\r\n    } else {\r\n      setUser(prev => ({ ...prev, [name]: value ?? '' }));\r\n    }\r\n  }\r\n\r\n  function addAvailableDay() {\r\n    setUser(prev => ({\r\n      ...prev,\r\n      availableDays: [...prev.availableDays, { day: '', startTime: '', endTime: '' }]\r\n    }));\r\n  }\r\n\r\n  function updateAvailableDay(index, field, value) {\r\n    const updated = [...user.availableDays];\r\n    updated[index][field] = value;\r\n    setUser(prev => ({ ...prev, availableDays: updated }));\r\n  }\r\n\r\n  function removeAvailableDay(index) {\r\n    const updated = user.availableDays.filter((_, i) => i !== index);\r\n    setUser(prev => ({ ...prev, availableDays: updated }));\r\n  }\r\n\r\n  async function sendData() {\r\n    const formData = new FormData();\r\n\r\n    for (const key in user) {\r\n      if (key === \"availableDays\") {\r\n        formData.append(\"availableDays\", JSON.stringify(user.availableDays));\r\n      } else if (key === \"profilePicture\") {\r\n        if (user.profilePicture) {\r\n          formData.append(\"profilePicture\", user.profilePicture);\r\n        }\r\n      } else {\r\n        formData.append(key, user[key] ?? '');\r\n      }\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      const res = await axios.post(\r\n        `${baseUrl}/api/account/register/worker`,\r\n        formData,\r\n        {\r\n          headers: { \"Content-Type\": \"multipart/form-data\" },\r\n          validateStatus: () => true\r\n        }\r\n      );\r\n\r\n      if (res.data.errors == null) {\r\n        localStorage.setItem(\"token\", res.data.token);\r\n        localStorage.setItem(\"userData\", JSON.stringify(res.data));\r\n        saveUserData();\r\n        window.location.href = \"/\";\r\n      } else {\r\n        setError(res.data.errors);\r\n      }\r\n    } catch (err) {\r\n      setError(\"Failed to send data. Try again later.\");\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }\r\n\r\n  function submitForm() {\r\n    sendData();\r\n  }\r\n\r\n  return (\r\n    <SignUpIndustrialContext.Provider\r\n      value={{\r\n        error,\r\n        cities,\r\n        services,\r\n        isLoading,\r\n        user,\r\n        getUserData,\r\n        submitForm,\r\n        addAvailableDay,\r\n        updateAvailableDay,\r\n        removeAvailableDay,\r\n        setUser,\r\n        clearError: () => setError(null)\r\n      }}\r\n    >\r\n      {children}\r\n    </SignUpIndustrialContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useSignUpIndustrial() {\r\n  const context = useContext(SignUpIndustrialContext);\r\n  if (!context) {\r\n    throw new Error(\"useSignUpIndustrial must be used within a SignUpIndustrialProvider\");\r\n  }\r\n  return context;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 981, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 987, "column": 0}, "map": {"version":3,"sources":["file://D%3A/front_end/projects/next_js/smart-finshing/app/scrolltotop/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { FaArrowUp } from \"react-icons/fa\";\r\n\r\nexport default function ScrollToTop() {\r\n    const [isVisible, setIsVisible] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const toggleVisibility = () => {\r\n            if (window.scrollY > 200) {\r\n                setIsVisible(true);\r\n            } else {\r\n                setIsVisible(false);\r\n            }\r\n        };\r\n\r\n        window.addEventListener(\"scroll\", toggleVisibility);\r\n        return () => window.removeEventListener(\"scroll\", toggleVisibility);\r\n    }, []);\r\n\r\n    const scrollToTop = () => {\r\n        window.scrollTo({ top: 0, behavior: \"smooth\" });\r\n    };\r\n\r\n    return (\r\n        <button\r\n            onClick={scrollToTop}\r\n            className={`fixed bottom-20 right-4 bg-green-600 text-white p-3 rounded-full shadow-lg hover:bg-green-700 transition-opacity duration-300 ${\r\n                isVisible ? \"opacity-100\" : \"opacity-0\"\r\n            }`}\r\n        >\r\n            <FaArrowUp size={20} />\r\n        </button>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;AAFA;;;;AAIe,SAAS;IACpB,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAE3C,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACN,MAAM,mBAAmB;YACrB,IAAI,OAAO,OAAO,GAAG,KAAK;gBACtB,aAAa;YACjB,OAAO;gBACH,aAAa;YACjB;QACJ;QAEA,OAAO,gBAAgB,CAAC,UAAU;QAClC,OAAO,IAAM,OAAO,mBAAmB,CAAC,UAAU;IACtD,GAAG,EAAE;IAEL,MAAM,cAAc;QAChB,OAAO,QAAQ,CAAC;YAAE,KAAK;YAAG,UAAU;QAAS;IACjD;IAEA,qBACI,8OAAC;QACG,SAAS;QACT,WAAW,CAAC,8HAA8H,EACtI,YAAY,gBAAgB,aAC9B;kBAEF,cAAA,8OAAC,8IAAA,CAAA,YAAS;YAAC,MAAM;;;;;;;;;;;AAG7B"}},
    {"offset": {"line": 1032, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1038, "column": 0}, "map": {"version":3,"sources":["file://D%3A/front_end/projects/next_js/smart-finshing/app/components/ProtectedRoute.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter, usePathname } from \"next/navigation\";\r\nimport { useToken } from \"../context/token_context\";\r\n\r\nexport default function ProtectedRoute({ children }: { children: React.ReactNode }) {\r\n  const { userData, saveUserData } = useToken();\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const [checking, setChecking] = useState(true);\r\n\r\n  const publicRoutes = [\r\n    \"/\",\r\n    \"/login\",\r\n    \"/signup\",\r\n    \"/signup-customer\",\r\n    \"/signup-worker\",\r\n    \"/signup-admin\",\r\n    \"/not-found\",\r\n  ];\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem(\"token\");\r\n\r\n    if (publicRoutes.includes(pathname)) {\r\n      setChecking(false);\r\n      return;\r\n    }\r\n\r\n    if (!userData && token) {\r\n      saveUserData(); // decode token\r\n      setChecking(false);\r\n    } else if (!userData && !token) {\r\n      router.push(\"/login\");\r\n    } else {\r\n      setChecking(false);\r\n    }\r\n  }, [pathname]);\r\n\r\n  if (checking) {\r\n    return (\r\n      <div className=\"flex justify-center items-center h-screen\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-4 border-green-600 border-solid\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return <>{children}</>;\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS,eAAe,EAAE,QAAQ,EAAiC;IAChF,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,GAAG,CAAA,GAAA,gIAAA,CAAA,WAAQ,AAAD;IAC1C,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,WAAW,CAAA,GAAA,kIAAA,CAAA,cAAW,AAAD;IAC3B,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAEzC,MAAM,eAAe;QACnB;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,QAAQ,aAAa,OAAO,CAAC;QAEnC,IAAI,aAAa,QAAQ,CAAC,WAAW;YACnC,YAAY;YACZ;QACF;QAEA,IAAI,CAAC,YAAY,OAAO;YACtB,gBAAgB,eAAe;YAC/B,YAAY;QACd,OAAO,IAAI,CAAC,YAAY,CAAC,OAAO;YAC9B,OAAO,IAAI,CAAC;QACd,OAAO;YACL,YAAY;QACd;IACF,GAAG;QAAC;KAAS;IAEb,IAAI,UAAU;QACZ,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;;;;;;;;;;;IAGrB;IAEA,qBAAO;kBAAG;;AACZ"}},
    {"offset": {"line": 1101, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}