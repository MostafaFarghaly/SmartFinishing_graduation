{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://D%3A/front_end/projects/next_js/smart-finshing/app/send-request/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\nimport \"@fortawesome/fontawesome-free/css/all.min.css\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport { useApi } from \"../../context/ApiContext\";\r\n\r\nexport default function SendRequestPage() {\r\n  const { id } = useParams(); // workerId\r\n  const router = useRouter();\r\n  const { baseUrl } = useApi();\r\n\r\n  const [projectId, setProjectId] = useState<number>(0);\r\n  const [projects, setProjects] = useState<any[]>([]);\r\n  const [response, setResponse] = useState<any>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // Worker Info\r\n  const [workerName, setWorkerName] = useState<string>(\"\");\r\n  const [workerImage, setWorkerImage] = useState<string>(\"\");\r\n  const [serviceName, setServiceName] = useState<string>(\"\");\r\n  const [rating, setRating] = useState<number>(0);\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const token = localStorage.getItem(\"token\");\r\n\r\n        // Get Projects\r\n        const projectsRes = await fetch(`${baseUrl}/api/Projects`, {\r\n          headers: {\r\n            Authorization: token ? `Bearer ${token}` : \"\",\r\n          },\r\n        });\r\n        if (!projectsRes.ok) throw new Error(\"Failed to load projects\");\r\n        const projectsData = await projectsRes.json();\r\n        setProjects(projectsData);\r\n\r\n        // Get Worker Info\r\n        const workerRes = await fetch(`${baseUrl}/api/Profile/workers/${id}`, {\r\n          headers: {\r\n            Authorization: token ? `Bearer ${token}` : \"\",\r\n          },\r\n        });\r\n        if (workerRes.ok) {\r\n          const workerData = await workerRes.json();\r\n          setWorkerName(workerData.name || \"Unknown\");\r\n          setWorkerImage(workerData.profilePictureUrl || \"\");\r\n          setServiceName(workerData.serviceName || \"\");\r\n          setRating(workerData.rating || 0);\r\n        } else {\r\n          setWorkerName(\"Unknown\");\r\n        }\r\n      } catch (err: any) {\r\n        setError(err.message || \"An error occurred while fetching data\");\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [baseUrl, id]);\r\n\r\n  const handleSubmit = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const res = await fetch(`${baseUrl}/api/Requests`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: token ? `Bearer ${token}` : \"\",\r\n        },\r\n        body: JSON.stringify({\r\n          workerId: Number(id),\r\n          projectId,\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) throw new Error(\"Failed to send request\");\r\n      const data = await res.json();\r\n      setResponse(data);\r\n\r\n      setTimeout(() => {\r\n        router.push(\"/requests\");\r\n      }, 1500);\r\n    } catch (err: any) {\r\n      setError(err.message || \"An unexpected error occurred\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-b from-blue-50 to-white py-12 px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"max-w-md mx-auto bg-white rounded-2xl shadow-xl p-8 space-y-6\">\r\n        {/* Back Button */}\r\n        <button\r\n          onClick={() => router.back()}\r\n          className=\"text-sm text-blue-600 hover:underline flex items-center gap-1\"\r\n        >\r\n          <i className=\"fas fa-arrow-left\"></i>\r\n          Back\r\n        </button>\r\n\r\n        {/* Title */}\r\n        <h1 className=\"text-3xl font-bold text-center text-blue-700\">\r\n          <i className=\"fas fa-paper-plane mr-2\"></i>Send Request\r\n        </h1>\r\n\r\n        {/* Worker Info */}\r\n        <div className=\"flex items-center gap-4\">\r\n          {workerImage && (\r\n            <img\r\n              src={workerImage}\r\n              alt=\"Worker\"\r\n              className=\"w-16 h-16 rounded-full object-cover border border-gray-300\"\r\n            />\r\n          )}\r\n          <div className=\"flex-1\">\r\n            <p className=\"text-lg font-semibold text-gray-800\">{workerName}</p>\r\n            <p className=\"text-sm text-gray-500\">{serviceName}</p>\r\n            <div className=\"text-yellow-500 text-sm\">\r\n              {Array.from({ length: 5 }, (_, i) => (\r\n                <i\r\n                  key={i}\r\n                  className={`fa-star ${i < rating ? \"fas\" : \"far\"} mr-1`}\r\n                ></i>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Select Project */}\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n            Choose a Project\r\n          </label>\r\n          <select\r\n            className=\"w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n            value={projectId}\r\n            onChange={(e) => setProjectId(Number(e.target.value))}\r\n            disabled={projects.length === 0}\r\n          >\r\n            <option value={0}>-- Select a project --</option>\r\n            {projects.map((project) => (\r\n              <option key={project.id} value={project.id}>\r\n                {project.name} - {project.apartmentType}\r\n              </option>\r\n            ))}\r\n          </select>\r\n\r\n          {projects.length === 0 && (\r\n            <div className=\"mt-2 text-blue-600 flex items-center gap-2 text-sm\">\r\n              <i className=\"fas fa-info-circle\"></i>\r\n              <span>No projects found.</span>\r\n              <a\r\n                href=\"/startProject\"\r\n                className=\"text-blue-700 hover:underline font-semibold\"\r\n              >\r\n                + Start one\r\n              </a>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Submit Button */}\r\n        <button\r\n          onClick={handleSubmit}\r\n          disabled={loading || projectId === 0}\r\n          className={`w-full flex justify-center items-center gap-2 py-2 px-4 rounded-lg text-white text-sm font-semibold transition-all ${\r\n            loading || projectId === 0\r\n              ? \"bg-green-300 cursor-not-allowed\"\r\n              : \"bg-green-600 hover:bg-green-700 shadow-md\"\r\n          }`}\r\n        >\r\n          {loading ? (\r\n            <>\r\n              <i className=\"fa fa-spinner fa-spin\"></i>\r\n              Sending...\r\n            </>\r\n          ) : (\r\n            <>\r\n              <i className=\"fas fa-paper-plane\"></i>\r\n              Send Request\r\n            </>\r\n          )}\r\n        </button>\r\n\r\n        {/* Error Alert */}\r\n        {error && (\r\n          <div className=\"p-3 mt-2 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-md text-sm\">\r\n            <strong>Error:</strong> {error}\r\n          </div>\r\n        )}\r\n\r\n        {/* Success Alert */}\r\n        {response && (\r\n          <div className=\"p-3 mt-2 bg-green-100 border-l-4 border-green-500 text-green-700 rounded-md text-sm\">\r\n            <strong>Success!</strong> Request sent successfully.\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 357, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}