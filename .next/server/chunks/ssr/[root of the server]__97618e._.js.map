{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file://D%3A/front_end/projects/next_js/smart-finshing/app/viewprofile/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport Image from \"next/image\";\r\nimport { useParams } from \"next/navigation\";\r\nimport { useToken } from \"../../context/token_context\";\r\nimport { useLoginClient } from \"../../context/regester/login_context\";\r\n\r\n\r\ntype Review = {\r\n  customerName: string;\r\n  comment: string;\r\n  rating: number;\r\n};\r\n\r\ntype Worker = {\r\n  id: number;\r\n  name: string;\r\n  description: string;\r\n  companyName: string;\r\n  experienceYears: number;\r\n  profilePictureUrl: string;\r\n  city: string;\r\n  phoneNumber: string;\r\n  serviceName: string;\r\n  rating: number | null;\r\n  reviews: Review[];\r\n  portfolioItems: {\r\n    imageUrls: string[];\r\n  }[];\r\n};\r\n\r\nexport default function ViewProfile() {\r\n  const params = useParams();\r\n  const id = params?.id as string;\r\n\r\n  const [worker, setWorker] = useState<Worker | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [newPortfolioImages, setNewPortfolioImages] = useState<FileList | null>(null);\r\n  const [uploading, setUploading] = useState(false);\r\n\r\n  const { userData } = useToken();\r\n  const { saveData } = useLoginClient();\r\n\r\n  const userRole =\r\n    userData?.[\"http://schemas.microsoft.com/ws/2008/06/identity/claims/role\"] || \"\";\r\n\r\n  const isOwnProfile =\r\n    userRole === \"Worker\" && id === String(saveData?.workerId);\r\n\r\n  useEffect(() => {\r\n    const fetchWorker = async () => {\r\n      try {\r\n        const res = await fetch(\r\n          `https://projectapi-ekhpcndsdgbahqhm.canadacentral-01.azurewebsites.net/api/Profile/workers/${id}`\r\n        );\r\n        if (!res.ok) throw new Error(\"Worker not found\");\r\n        const data = await res.json();\r\n        setWorker(data);\r\n      } catch (err) {\r\n        console.error(\"Error fetching worker:\", err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    if (id) fetchWorker();\r\n  }, [id]);\r\n\r\n  const handleUpload = async () => {\r\n    if (!newPortfolioImages || !worker) return;\r\n\r\n    const formData = new FormData();\r\n    for (let i = 0; i < newPortfolioImages.length; i++) {\r\n      formData.append(\"ImageFiles\", newPortfolioImages[i]);\r\n    }\r\n\r\n    const portfolioName = \"New Portfolio\";\r\n    const portfolioDescription = \"Uploaded from client view\";\r\n\r\n    setUploading(true);\r\n    try {\r\n      const url = `https://projectapi-ekhpcndsdgbahqhm.canadacentral-01.azurewebsites.net/api/Portfolio?Name=${encodeURIComponent(\r\n        portfolioName\r\n      )}&Description=${encodeURIComponent(portfolioDescription)}`;\r\n\r\n      const res = await fetch(url, {\r\n        method: \"POST\",\r\n        body: formData,\r\n        headers: {\r\n          Accept: \"application/json\",\r\n        },\r\n      });\r\n\r\n      const responseText = await res.text();\r\n      console.log(\"üîç Status Code:\", res.status);\r\n      console.log(\"üîç Response Text:\", responseText);\r\n\r\n      if (!res.ok) {\r\n        throw new Error(\"Upload failed\");\r\n      }\r\n\r\n      const newPortfolioItem = JSON.parse(responseText);\r\n      setWorker((prev) =>\r\n        prev\r\n          ? {\r\n              ...prev,\r\n              portfolioItems: [\r\n                ...prev.portfolioItems,\r\n                { imageUrls: newPortfolioItem.imageUrls },\r\n              ],\r\n            }\r\n          : prev\r\n      );\r\n\r\n      setNewPortfolioImages(null);\r\n    } catch (err) {\r\n      console.error(\"Error uploading portfolio:\", err);\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) return <div className=\"p-4\">Loading...</div>;\r\n  if (!worker) return <div className=\"p-4 text-red-500\">Worker not found.</div>;\r\n\r\n  return (\r\n    <div className=\"p-4 bg-white\">\r\n      {/* Header */}\r\n      <div className=\"flex border-b pb-4 mb-4\">\r\n        <Image\r\n          src={worker.profilePictureUrl || \"/images/default-user.png\"}\r\n          alt=\"Profile\"\r\n          width={60}\r\n          height={100}\r\n          className=\"rounded-lg object-cover\"\r\n        />\r\n        <div className=\"ml-4\">\r\n          <h1 className=\"text-2xl font-semibold\">{worker.name}</h1>\r\n          <p className=\"text-gray-500\">{worker.companyName}</p>\r\n          <p className=\"text-red-500\">\r\n            ‚≠ê {worker.rating ?? \"No rating\"} ({worker.reviews.length} reviews)\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex gap-6\">\r\n        {/* Left Column */}\r\n        <div className=\"flex-1\">\r\n          {/* About Section */}\r\n          <div className=\"mb-6\">\r\n            <h2 className=\"text-lg font-semibold\">About</h2>\r\n            <p className=\"text-gray-600 text-sm\">{worker.description}</p>\r\n            <button className=\"mt-4 bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition\">\r\n              Request a quote\r\n            </button>\r\n          </div>\r\n\r\n          {/* Highlights */}\r\n          <div className=\"grid grid-cols-2 gap-4 border-t pt-4 mb-6\">\r\n            <div>\r\n              <h3 className=\"text-sm font-semibold\">Service</h3>\r\n              <p className=\"text-gray-600 text-sm\">{worker.serviceName}</p>\r\n            </div>\r\n            <div>\r\n              <h3 className=\"text-sm font-semibold\">Experience</h3>\r\n              <p className=\"text-gray-600 text-sm\">\r\n                {worker.experienceYears} years\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <h3 className=\"text-sm font-semibold\">Phone</h3>\r\n              <p className=\"text-gray-600 text-sm\">{worker.phoneNumber}</p>\r\n            </div>\r\n            <div>\r\n              <h3 className=\"text-sm font-semibold\">City</h3>\r\n              <p className=\"text-gray-600 text-sm\">{worker.city}</p>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Reviews */}\r\n          <div className=\"border-t pt-4 mb-6\">\r\n            <h2 className=\"text-lg font-semibold\">Reviews</h2>\r\n            {worker.reviews.length === 0 && (\r\n              <p className=\"text-gray-500 text-sm\">No reviews yet.</p>\r\n            )}\r\n            {worker.reviews.map((review, index) => (\r\n              <div key={index} className=\"mt-4\">\r\n                <p className=\"text-sm font-semibold\">{review.customerName}</p>\r\n                <p className=\"text-gray-600 text-sm\">\"{review.comment}\"</p>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Portfolio */}\r\n        <div className=\"w-80\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h2 className=\"text-lg font-semibold\">Portfolio</h2>\r\n\r\n            {isOwnProfile && (\r\n              <label className=\"cursor-pointer bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition\">\r\n                + Add Portfolio\r\n                <input\r\n                  type=\"file\"\r\n                  multiple\r\n                  accept=\"image/*\"\r\n                  className=\"hidden\"\r\n                  onChange={(e) => setNewPortfolioImages(e.target.files)}\r\n                />\r\n              </label>\r\n            )}\r\n          </div>\r\n\r\n          {isOwnProfile && newPortfolioImages && (\r\n            <button\r\n              onClick={handleUpload}\r\n              disabled={uploading}\r\n              className=\"mb-4 bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition\"\r\n            >\r\n              {uploading ? \"Uploading...\" : \"Upload\"}\r\n            </button>\r\n          )}\r\n\r\n          <div className=\"grid grid-cols-2 gap-2\">\r\n            {worker.portfolioItems.flatMap((item) =>\r\n              item.imageUrls.map((url, index) => (\r\n                <Image\r\n                  key={index}\r\n                  src={url}\r\n                  alt={`Portfolio ${index + 1}`}\r\n                  width={100}\r\n                  height={100}\r\n                  className=\"rounded-lg object-cover\"\r\n                />\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 489, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}