{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://D%3A/front_end/projects/next_js/smart-finshing/app/projects/%5Bid%5D/edit/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport { useApi } from \"../../../context/ApiContext\";\r\n\r\nconst spaceTypes = [\"Apartment\", \"Villa\", \"Studio\", \"Office\", \"Duplex\"];\r\nconst finishStyles = [\"Modern\", \"Classic\", \"Minimalist\", \"Industrial\", \"Bohemian\"];\r\nconst qualityLevels = [\"High Quality\", \"Medium Quality\", \"Economy Quality\"];\r\n\r\ntype Service = { id: number; name: string };\r\n\r\nexport default function EditProjectPage() {\r\n  const { baseUrl } = useApi();\r\n  const { id } = useParams();\r\n  const router = useRouter();\r\n\r\n  const [step, setStep] = useState(1);\r\n  const [loading, setLoading] = useState(true);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [services, setServices] = useState<Service[]>([]);\r\n\r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    serviceId: \"\",\r\n    apartmentType: \"\",\r\n    apartmentSize: \"\",\r\n    preferredStyle: \"\",\r\n    materialQuality: \"\",\r\n    minBudget: \"\",\r\n    maxBudget: \"\",\r\n    details: \"\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const token = localStorage.getItem(\"token\");\r\n\r\n        // تحميل بيانات المشروع\r\n        const res = await fetch(`${baseUrl}/api/Projects/${id}`, {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        const text = await res.text();\r\n        if (!text) throw new Error(\"Empty response from project API\");\r\n        const data = JSON.parse(text);\r\n\r\n        setFormData({\r\n          name: data.name ?? \"\",\r\n          serviceId: data.serviceId?.toString() ?? \"\",\r\n          apartmentType: data.apartmentType ?? \"\",\r\n          apartmentSize: data.apartmentSize ?? \"\",\r\n          preferredStyle: data.preferredStyle ?? \"\",\r\n          materialQuality: data.materialQuality ?? \"\",\r\n          minBudget: data.minBudget?.toString() ?? \"\",\r\n          maxBudget: data.maxBudget?.toString() ?? \"\",\r\n          details: data.details ?? \"\",\r\n        });\r\n\r\n        // تحميل الخدمات\r\n        const catRes = await fetch(`${baseUrl}/api/Categories`);\r\n        const catJson = await catRes.json();\r\n        const extractedServices = (catJson?.data || []).flatMap((category: any) =>\r\n          (category.services || []).map((s: any) => ({\r\n            id: s.id,\r\n            name: s.name,\r\n          }))\r\n        );\r\n        setServices(extractedServices);\r\n      } catch (err: any) {\r\n        setError(err.message || \"Something went wrong.\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [baseUrl, id]);\r\n\r\n  const handleChange = (e: any) => {\r\n    const { name, value } = e.target;\r\n    setFormData((prev) => ({ ...prev, [name]: value }));\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    setSubmitting(true);\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n\r\n      const res = await fetch(`${baseUrl}/api/Projects/${id}`, {\r\n        method: \"PUT\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n        body: JSON.stringify({\r\n          ...formData,\r\n          serviceId: parseInt(formData.serviceId),\r\n          minBudget: parseInt(formData.minBudget),\r\n          maxBudget: parseInt(formData.maxBudget),\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const errorText = await res.text();\r\n        throw new Error(errorText || \"Failed to update project\");\r\n      }\r\n\r\n      alert(\"Project updated successfully!\");\r\n      router.push(`/projects/${id}`);\r\n    } catch (err: any) {\r\n      alert(\"Error: \" + err.message);\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (loading)\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center py-20 text-center\">\r\n        <div className=\"animate-spin rounded-full h-16 w-16 border-4 border-t-green-600 border-gray-300 mb-4\"></div>\r\n        <h3 className=\"text-lg font-semibold text-gray-700\">Loading Data...</h3>\r\n        <p className=\"text-sm text-gray-400 mt-1\">Please wait, this may take a moment.</p>\r\n      </div>\r\n    );\r\n  if (error) return <p className=\"text-center mt-10 text-red-600\">{error}</p>;\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-xl mx-auto bg-white shadow rounded-xl\">\r\n      <h1 className=\"text-xl font-bold mb-4\">Edit Project</h1>\r\n\r\n      {/* الخطوة الأولى */}\r\n      {step === 1 && (\r\n        <div className=\"space-y-4\">\r\n          <input\r\n            type=\"text\"\r\n            name=\"name\"\r\n            value={formData.name}\r\n            onChange={handleChange}\r\n            placeholder=\"Project Name\"\r\n            className=\"w-full border px-4 py-2 rounded\"\r\n          />\r\n          <select\r\n            name=\"serviceId\"\r\n            value={formData.serviceId || \"\"}\r\n            onChange={handleChange}\r\n            className=\"w-full border px-4 py-2 rounded\"\r\n          >\r\n            <option value=\"\">Select Service</option>\r\n            {services.map((s) => (\r\n              <option key={s.id} value={s.id}>\r\n                {s.name}\r\n              </option>\r\n            ))}\r\n          </select>\r\n          <select\r\n            name=\"apartmentType\"\r\n            value={formData.apartmentType || \"\"}\r\n            onChange={handleChange}\r\n            className=\"w-full border px-4 py-2 rounded\"\r\n          >\r\n            <option value=\"\">Select Apartment Type</option>\r\n            {spaceTypes.map((t) => (\r\n              <option key={t} value={t}>\r\n                {t}\r\n              </option>\r\n            ))}\r\n          </select>\r\n          <input\r\n            type=\"text\"\r\n            name=\"apartmentSize\"\r\n            value={formData.apartmentSize}\r\n            onChange={handleChange}\r\n            placeholder=\"Apartment Size\"\r\n            className=\"w-full border px-4 py-2 rounded\"\r\n          />\r\n          <button\r\n            onClick={() => setStep(2)}\r\n            disabled={submitting}\r\n            className={`flex items-center justify-center bg-blue-600 text-white px-4 py-2 rounded w-full ${\r\n              submitting ? \"opacity-70 cursor-not-allowed\" : \"\"\r\n            }`}\r\n          >\r\n            {submitting ? (\r\n              <>\r\n                <svg className=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                  <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                  <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                </svg>\r\n                Loading...\r\n              </>\r\n            ) : (\r\n              \"Next\"\r\n            )}\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {/* الخطوة الثانية */}\r\n      {step === 2 && (\r\n        <div className=\"space-y-4\">\r\n          <select\r\n            name=\"preferredStyle\"\r\n            value={formData.preferredStyle || \"\"}\r\n            onChange={handleChange}\r\n            className=\"w-full border px-4 py-2 rounded\"\r\n          >\r\n            <option value=\"\">Select Style</option>\r\n            {finishStyles.map((style) => (\r\n              <option key={style} value={style}>\r\n                {style}\r\n              </option>\r\n            ))}\r\n          </select>\r\n\r\n          <select\r\n            name=\"materialQuality\"\r\n            value={formData.materialQuality || \"\"}\r\n            onChange={handleChange}\r\n            className=\"w-full border px-4 py-2 rounded\"\r\n          >\r\n            <option value=\"\">Select Material Quality</option>\r\n            {qualityLevels.map((q) => (\r\n              <option key={q} value={q}>\r\n                {q}\r\n              </option>\r\n            ))}\r\n          </select>\r\n\r\n          <input\r\n            type=\"number\"\r\n            name=\"minBudget\"\r\n            value={formData.minBudget}\r\n            onChange={handleChange}\r\n            placeholder=\"Min Budget\"\r\n            className=\"w-full border px-4 py-2 rounded\"\r\n          />\r\n          <input\r\n            type=\"number\"\r\n            name=\"maxBudget\"\r\n            value={formData.maxBudget}\r\n            onChange={handleChange}\r\n            placeholder=\"Max Budget\"\r\n            className=\"w-full border px-4 py-2 rounded\"\r\n          />\r\n          <textarea\r\n            name=\"details\"\r\n            value={formData.details}\r\n            onChange={handleChange}\r\n            placeholder=\"Details\"\r\n            className=\"w-full border px-4 py-2 rounded\"\r\n          />\r\n          <div className=\"flex justify-between gap-2\">\r\n            <button\r\n              onClick={() => setStep(1)}\r\n              disabled={submitting}\r\n              className={`bg-gray-500 text-white px-4 py-2 rounded flex-1 ${\r\n                submitting ? \"opacity-70 cursor-not-allowed\" : \"\"\r\n              }`}\r\n            >\r\n              Back\r\n            </button>\r\n            <button\r\n              onClick={handleSubmit}\r\n              disabled={submitting}\r\n              className={`flex items-center justify-center bg-green-600 text-white px-4 py-2 rounded flex-1 ${\r\n                submitting ? \"opacity-70 cursor-not-allowed\" : \"\"\r\n              }`}\r\n            >\r\n              {submitting ? (\r\n                <>\r\n                  <svg className=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                    <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                    <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                  </svg>\r\n                  Saving...\r\n                </>\r\n              ) : (\r\n                \"Save\"\r\n              )}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 497, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}