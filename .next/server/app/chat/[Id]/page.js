(()=>{var e={};e.id=8877,e.ids=[8877],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12412:e=>{"use strict";e.exports=require("assert")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},27910:e=>{"use strict";e.exports=require("stream")},83997:e=>{"use strict";e.exports=require("tty")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},51238:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalError:()=>i.a,__next_app__:()=>d,pages:()=>h,routeModule:()=>u,tree:()=>l});var r=n(70260),s=n(28203),o=n(25155),i=n.n(o),a=n(67292),c={};for(let e in a)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>a[e]);n.d(t,c);let l=["",{children:["chat",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(n.bind(n,13195)),"D:\\front_end\\projects\\next_js\\Graduation_project\\smart-finshing\\app\\chat\\[id]\\page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(n.bind(n,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(n.bind(n,19611)),"D:\\front_end\\projects\\next_js\\Graduation_project\\smart-finshing\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(n.t.bind(n,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(n.t.bind(n,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(n.t.bind(n,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(n.bind(n,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],h=["D:\\front_end\\projects\\next_js\\Graduation_project\\smart-finshing\\app\\chat\\[id]\\page.tsx"],d={require:n,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/chat/[id]/page",pathname:"/chat/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},26507:(e,t,n)=>{Promise.resolve().then(n.bind(n,13195))},25827:(e,t,n)=>{Promise.resolve().then(n.bind(n,17003))},17003:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>L});var r,s,o,i,a,c=n(45512),l=n(58009),h=n(79334);class d{}d.Authorization="Authorization",d.Cookie="Cookie";class u{constructor(e,t,n){this.statusCode=e,this.statusText=t,this.content=n}}class g{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}class _ extends Error{constructor(e,t){let n=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=n}}class p extends Error{constructor(e="A timeout occurred."){let t=new.target.prototype;super(e),this.__proto__=t}}class f extends Error{constructor(e="An abort occurred."){let t=new.target.prototype;super(e),this.__proto__=t}}!function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Information=2]="Information",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Critical=5]="Critical",e[e.None=6]="None"}(r||(r={}));class m{constructor(){}log(e,t){}}m.instance=new m;class b{static isRequired(e,t){if(null==e)throw Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,n){if(!(e in t))throw Error(`Unknown ${n} value: ${e}.`)}}class v{static get isBrowser(){return!v.isNode&&"object"==typeof window&&"object"==typeof window.document}static get isWebWorker(){return!v.isNode&&"object"==typeof self&&"importScripts"in self}static get isReactNative(){return!v.isNode&&"object"==typeof window&&void 0===window.document}static get isNode(){return"undefined"!=typeof process&&process.release&&"node"===process.release.name}}function y(e,t){let n="";return w(e)?(n=`Binary data of length ${e.byteLength}`,t&&(n+=`. Content: '${function(e){let t=new Uint8Array(e),n="";return t.forEach(e=>{let t=e<16?"0":"";n+=`0x${t}${e.toString(16)} `}),n.substr(0,n.length-1)}(e)}'`)):"string"==typeof e&&(n=`String data of length ${e.length}`,t&&(n+=`. Content: '${e}'`)),n}function w(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}async function C(e,t,n,s,o,i){let a={},[c,l]=S();a[c]=l,e.log(r.Trace,`(${t} transport) sending data. ${y(o,i.logMessageContent)}.`);let h=w(o)?"arraybuffer":"text",d=await n.post(s,{content:o,headers:{...a,...i.headers},responseType:h,timeout:i.timeout,withCredentials:i.withCredentials});e.log(r.Trace,`(${t} transport) request complete. Response status: ${d.statusCode}.`)}class x{constructor(e,t){this._subject=e,this._observer=t}dispose(){let e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),0===this._subject.observers.length&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(e=>{})}}function S(){let e="X-SignalR-User-Agent";return v.isNode&&(e="User-Agent"),[e,function(e,t,n,r){let s="Microsoft SignalR/",o=e.split(".");return s+=`${o[0]}.${o[1]} (${e}; `,t&&""!==t?s+=`${t}; `:s+="Unknown OS; ",s+=`${n}`,r?s+=`; ${r}`:s+="; Unknown Runtime Version",s+=")"}("8.0.7",function(){if(!v.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}(),v.isNode?"NodeJS":"Browser",function(){if(v.isNode)return process.versions.node}())]}function I(e){return e.stack?e.stack:e.message?e.message:`${e}`}class k extends g{constructor(e){if(super(),this._logger=e,"undefined"==typeof fetch||v.isNode){let e=require;this._jar=new(e("tough-cookie")).CookieJar,"undefined"==typeof fetch?this._fetchType=e("node-fetch"):this._fetchType=fetch,this._fetchType=e("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("could not find global")}());if("undefined"==typeof AbortController){let e=require;this._abortControllerType=e("abort-controller")}else this._abortControllerType=AbortController}async send(e){let t,n;if(e.abortSignal&&e.abortSignal.aborted)throw new f;if(!e.method)throw Error("No method defined.");if(!e.url)throw Error("No url defined.");let s=new this._abortControllerType;e.abortSignal&&(e.abortSignal.onabort=()=>{s.abort(),t=new f});let o=null;e.timeout&&(o=setTimeout(()=>{s.abort(),this._logger.log(r.Warning,"Timeout from HTTP request."),t=new p},e.timeout)),""===e.content&&(e.content=void 0),e.content&&(e.headers=e.headers||{},w(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{n=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:!0===e.withCredentials?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:s.signal})}catch(e){if(t)throw t;throw this._logger.log(r.Warning,`Error from HTTP request. ${e}.`),e}finally{o&&clearTimeout(o),e.abortSignal&&(e.abortSignal.onabort=null)}if(!n.ok)throw new _(await T(n,"text")||n.statusText,n.status);let i=T(n,e.responseType),a=await i;return new u(n.status,n.statusText,a)}getCookieString(e){let t="";return v.isNode&&this._jar&&this._jar.getCookies(e,(e,n)=>t=n.join("; ")),t}}function T(e,t){let n;switch(t){case"arraybuffer":n=e.arrayBuffer();break;case"text":default:n=e.text();break;case"blob":case"document":case"json":throw Error(`${t} is not supported.`)}return n}class P extends g{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new f):e.method?e.url?new Promise((t,n)=>{let s=new XMLHttpRequest;s.open(e.method,e.url,!0),s.withCredentials=void 0===e.withCredentials||e.withCredentials,s.setRequestHeader("X-Requested-With","XMLHttpRequest"),""===e.content&&(e.content=void 0),e.content&&(w(e.content)?s.setRequestHeader("Content-Type","application/octet-stream"):s.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));let o=e.headers;o&&Object.keys(o).forEach(e=>{s.setRequestHeader(e,o[e])}),e.responseType&&(s.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{s.abort(),n(new f)}),e.timeout&&(s.timeout=e.timeout),s.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),s.status>=200&&s.status<300?t(new u(s.status,s.statusText,s.response||s.responseText)):n(new _(s.response||s.responseText||s.statusText,s.status))},s.onerror=()=>{this._logger.log(r.Warning,`Error from HTTP request. ${s.status}: ${s.statusText}.`),n(new _(s.statusText,s.status))},s.ontimeout=()=>{this._logger.log(r.Warning,"Timeout from HTTP request."),n(new p)},s.send(e.content)}):Promise.reject(Error("No url defined.")):Promise.reject(Error("No method defined."))}}(function(e){e[e.None=0]="None",e[e.WebSockets=1]="WebSockets",e[e.ServerSentEvents=2]="ServerSentEvents",e[e.LongPolling=4]="LongPolling"})(s||(s={})),function(e){e[e.Text=1]="Text",e[e.Binary=2]="Binary"}(o||(o={}));class R{constructor(){this._isAborted=!1,this.onabort=null}abort(){!this._isAborted&&(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class E{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new j,this._transportResult=new j,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new j),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new j;let e=this._transportResult;this._transportResult=void 0;let t="string"==typeof this._buffer[0]?this._buffer.join(""):E._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(t){e.reject(t)}}}static _concatBuffers(e){let t=new Uint8Array(e.map(e=>e.byteLength).reduce((e,t)=>e+t)),n=0;for(let r of e)t.set(new Uint8Array(r),n),n+=r.byteLength;return t.buffer}}class j{constructor(){this.promise=new Promise((e,t)=>([this._resolver,this._rejecter]=[e,t]))}resolve(){this._resolver()}reject(e){this._rejecter(e)}}class ${static write(e){return`${e}${$.RecordSeparator}`}static parse(e){if(e[e.length-1]!==$.RecordSeparator)throw Error("Message is incomplete.");let t=e.split($.RecordSeparator);return t.pop(),t}}$.RecordSeparatorCode=30,$.RecordSeparator=String.fromCharCode($.RecordSeparatorCode);class D{writeHandshakeRequest(e){return $.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,n;if(w(e)){let r=new Uint8Array(e),s=r.indexOf($.RecordSeparatorCode);if(-1===s)throw Error("Message is incomplete.");let o=s+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(r.slice(0,o))),n=r.byteLength>o?r.slice(o).buffer:null}else{let r=e.indexOf($.RecordSeparator);if(-1===r)throw Error("Message is incomplete.");let s=r+1;t=e.substring(0,s),n=e.length>s?e.substring(s):null}let r=JSON.parse($.parse(t)[0]);if(r.type)throw Error("Expected a handshake response from the server.");return[n,r]}}!function(e){e[e.Invocation=1]="Invocation",e[e.StreamItem=2]="StreamItem",e[e.Completion=3]="Completion",e[e.StreamInvocation=4]="StreamInvocation",e[e.CancelInvocation=5]="CancelInvocation",e[e.Ping=6]="Ping",e[e.Close=7]="Close",e[e.Ack=8]="Ack",e[e.Sequence=9]="Sequence"}(i||(i={}));class q{constructor(){this.observers=[]}next(e){for(let t of this.observers)t.next(e)}error(e){for(let t of this.observers)t.error&&t.error(e)}complete(){for(let e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new x(this,e)}}class M{constructor(e,t,n){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=n}async _send(e){let t=this._protocol.writeMessage(e),n=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let e=()=>{},r=()=>{};w(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(n=new Promise((t,n)=>{e=t,r=n})),this._messages.push(new A(t,this._totalMessageCount,e,r))}try{this._reconnectInProgress||await this._connection.send(t)}catch{this._disconnected()}await n}_ack(e){let t=-1;for(let n=0;n<this._messages.length;n++){let r=this._messages[n];if(r._id<=e.sequenceId)t=n,w(r._message)?this._bufferedByteCount-=r._message.byteLength:this._bufferedByteCount-=r._message.length,r._resolver();else if(this._bufferedByteCount<this._bufferSize)r._resolver();else break}-1!==t&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type===i.Sequence&&(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;let t=this._nextReceivingSequenceId;return(this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId)?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){if(e.sequenceId>this._nextReceivingSequenceId){this._connection.stop(Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){let e=0!==this._messages.length?this._messages[0]._id:this._totalMessageCount+1;for(let t of(await this._connection.send(this._protocol.writeMessage({type:i.Sequence,sequenceId:e})),this._messages))await this._connection.send(t._message);this._reconnectInProgress=!1}_dispose(e){for(let t of(null!=e||(e=Error("Unable to reconnect to server.")),this._messages))t._rejector(e)}_isInvocationMessage(e){switch(e.type){case i.Invocation:case i.StreamItem:case i.Completion:case i.StreamInvocation:case i.CancelInvocation:return!0;case i.Close:case i.Sequence:case i.Ping:case i.Ack:return!1}}_ackTimer(){void 0===this._ackTimerHandle&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:i.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class A{constructor(e,t,n,r){this._message=e,this._id=t,this._resolver=n,this._rejector=r}}!function(e){e.Disconnected="Disconnected",e.Connecting="Connecting",e.Connected="Connected",e.Disconnecting="Disconnecting",e.Reconnecting="Reconnecting"}(a||(a={}));class N{static create(e,t,n,r,s,o,i){return new N(e,t,n,r,s,o,i)}constructor(e,t,n,s,o,c,l){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(r.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},b.isRequired(e,"connection"),b.isRequired(t,"logger"),b.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=null!=o?o:3e4,this.keepAliveIntervalInMilliseconds=null!=c?c:15e3,this._statefulReconnectBufferSize=null!=l?l:1e5,this._logger=t,this._protocol=n,this.connection=e,this._reconnectPolicy=s,this._handshakeProtocol=new D,this.connection.onreceive=e=>this._processIncomingData(e),this.connection.onclose=e=>this._connectionClosed(e),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=a.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:i.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==a.Disconnected&&this._connectionState!==a.Reconnecting)throw Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==a.Disconnected)return Promise.reject(Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=a.Connecting,this._logger.log(r.Debug,"Starting HubConnection.");try{await this._startInternal(),v.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=a.Connected,this._connectionStarted=!0,this._logger.log(r.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=a.Disconnected,this._logger.log(r.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;let e=new Promise((e,t)=>{this._handshakeResolver=e,this._handshakeRejecter=t});await this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);let n={protocol:this._protocol.name,version:t};if(this._logger.log(r.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(n)),this._logger.log(r.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;this.connection.features.reconnect&&(this._messageBuffer=new M(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(e){throw this._logger.log(r.Debug,`Hub handshake failed with error '${e}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(e),e}}async stop(){let e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch(e){}}_stopInternal(e){if(this._connectionState===a.Disconnected)return this._logger.log(r.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===a.Disconnecting)return this._logger.log(r.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;let t=this._connectionState;return(this._connectionState=a.Disconnecting,this._logger.log(r.Debug,"Stopping HubConnection."),this._reconnectDelayHandle)?(this._logger.log(r.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===a.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new f("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(e,...t){let n;let[r,s]=this._replaceStreamingParams(t),o=this._createStreamInvocation(e,t,s),a=new q;return a.cancelCallback=()=>{let e=this._createCancelInvocation(o.invocationId);return delete this._callbacks[o.invocationId],n.then(()=>this._sendWithProtocol(e))},this._callbacks[o.invocationId]=(e,t)=>{if(t){a.error(t);return}e&&(e.type===i.Completion?e.error?a.error(Error(e.error)):a.complete():a.next(e.item))},n=this._sendWithProtocol(o).catch(e=>{a.error(e),delete this._callbacks[o.invocationId]}),this._launchStreams(r,n),a}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){let[n,r]=this._replaceStreamingParams(t),s=this._sendWithProtocol(this._createInvocation(e,t,!0,r));return this._launchStreams(n,s),s}invoke(e,...t){let[n,r]=this._replaceStreamingParams(t),s=this._createInvocation(e,t,!1,r);return new Promise((e,t)=>{this._callbacks[s.invocationId]=(n,r)=>{if(r){t(r);return}n&&(n.type===i.Completion?n.error?t(Error(n.error)):e(n.result):t(Error(`Unexpected message type: ${n.type}`)))};let r=this._sendWithProtocol(s).catch(e=>{t(e),delete this._callbacks[s.invocationId]});this._launchStreams(n,r)})}on(e,t){e&&t&&(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),-1===this._methods[e].indexOf(t)&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();let n=this._methods[e];if(n){if(t){let r=n.indexOf(t);-1!==r&&(n.splice(r,1),0===n.length&&delete this._methods[e])}else delete this._methods[e]}}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){for(let t of this._protocol.parseMessages(e,this._logger))if(!this._messageBuffer||this._messageBuffer._shouldProcessMessage(t))switch(t.type){case i.Invocation:this._invokeClientMethod(t).catch(e=>{this._logger.log(r.Error,`Invoke client method threw error: ${I(e)}`)});break;case i.StreamItem:case i.Completion:{let e=this._callbacks[t.invocationId];if(e){t.type===i.Completion&&delete this._callbacks[t.invocationId];try{e(t)}catch(e){this._logger.log(r.Error,`Stream callback threw error: ${I(e)}`)}}break}case i.Ping:break;case i.Close:{this._logger.log(r.Information,"Close message received from server.");let e=t.error?Error("Server returned an error on close: "+t.error):void 0;!0===t.allowReconnect?this.connection.stop(e):this._stopPromise=this._stopInternal(e);break}case i.Ack:this._messageBuffer&&this._messageBuffer._ack(t);break;case i.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(t);break;default:this._logger.log(r.Warning,`Invalid message type: ${t.type}.`)}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,n;try{[n,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(n){let e="Error parsing handshake response: "+n;this._logger.log(r.Error,e);let t=Error(e);throw this._handshakeRejecter(t),t}if(t.error){let e="Server returned handshake error: "+t.error;this._logger.log(r.Error,e);let n=Error(e);throw this._handshakeRejecter(n),n}return this._logger.log(r.Debug,"Server handshake complete."),this._handshakeResolver(),n}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),void 0===this._pingServerHandle)){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===a.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){let t,n,s;let o=e.target.toLowerCase(),i=this._methods[o];if(!i){this._logger.log(r.Warning,`No client method with the name '${o}' found.`),e.invocationId&&(this._logger.log(r.Warning,`No result given for '${o}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)));return}let a=i.slice(),c=!!e.invocationId;for(let i of a)try{let a=t;t=await i.apply(this,e.arguments),c&&t&&a&&(this._logger.log(r.Error,`Multiple results provided for '${o}'. Sending error to server.`),s=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),n=void 0}catch(e){n=e,this._logger.log(r.Error,`A callback for the method '${o}' threw error '${e}'.`)}s?await this._sendWithProtocol(s):c?(n?s=this._createCompletionMessage(e.invocationId,`${n}`,null):void 0!==t?s=this._createCompletionMessage(e.invocationId,null,t):(this._logger.log(r.Warning,`No result given for '${o}' method and invocation ID '${e.invocationId}'.`),s=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(s)):t&&this._logger.log(r.Error,`Result given for '${o}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(r.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new f("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===a.Disconnecting?this._completeClose(e):this._connectionState===a.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===a.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=a.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(null!=e?e:Error("Connection closed.")),this._messageBuffer=void 0),v.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(r.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){let t=Date.now(),n=0,s=void 0!==e?e:Error("Attempting to reconnect due to a unknown error."),o=this._getNextRetryDelay(n++,0,s);if(null===o){this._logger.log(r.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(e);return}if(this._connectionState=a.Reconnecting,e?this._logger.log(r.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(r.Information,"Connection reconnecting."),0!==this._reconnectingCallbacks.length){try{this._reconnectingCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(r.Error,`An onreconnecting callback called with error '${e}' threw error '${t}'.`)}if(this._connectionState!==a.Reconnecting){this._logger.log(r.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;null!==o;){if(this._logger.log(r.Information,`Reconnect attempt number ${n} will start in ${o} ms.`),await new Promise(e=>{this._reconnectDelayHandle=setTimeout(e,o)}),this._reconnectDelayHandle=void 0,this._connectionState!==a.Reconnecting){this._logger.log(r.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=a.Connected,this._logger.log(r.Information,"HubConnection reconnected successfully."),0!==this._reconnectedCallbacks.length)try{this._reconnectedCallbacks.forEach(e=>e.apply(this,[this.connection.connectionId]))}catch(e){this._logger.log(r.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${e}'.`)}return}catch(e){if(this._logger.log(r.Information,`Reconnect attempt failed because of error '${e}'.`),this._connectionState!==a.Reconnecting){this._logger.log(r.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===a.Disconnecting&&this._completeClose();return}s=e instanceof Error?e:Error(e.toString()),o=this._getNextRetryDelay(n++,Date.now()-t,s)}}this._logger.log(r.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${n} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,n){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:n})}catch(n){return this._logger.log(r.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${n}'.`),null}}_cancelCallbacksWithError(e){let t=this._callbacks;this._callbacks={},Object.keys(t).forEach(n=>{let s=t[n];try{s(null,e)}catch(t){this._logger.log(r.Error,`Stream 'error' callback called with '${e}' threw error: ${I(t)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,n,r){if(n)return 0!==r.length?{arguments:t,streamIds:r,target:e,type:i.Invocation}:{arguments:t,target:e,type:i.Invocation};{let n=this._invocationId;return(this._invocationId++,0!==r.length)?{arguments:t,invocationId:n.toString(),streamIds:r,target:e,type:i.Invocation}:{arguments:t,invocationId:n.toString(),target:e,type:i.Invocation}}}_launchStreams(e,t){if(0!==e.length)for(let n in t||(t=Promise.resolve()),e)e[n].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(n)))},error:e=>{let r;r=e instanceof Error?e.message:e&&e.toString?e.toString():"Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(n,r)))},next:e=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(n,e)))}})}_replaceStreamingParams(e){let t=[],n=[];for(let r=0;r<e.length;r++){let s=e[r];if(this._isObservable(s)){let o=this._invocationId;this._invocationId++,t[o]=s,n.push(o.toString()),e.splice(r,1)}}return[t,n]}_isObservable(e){return e&&e.subscribe&&"function"==typeof e.subscribe}_createStreamInvocation(e,t,n){let r=this._invocationId;return(this._invocationId++,0!==n.length)?{arguments:t,invocationId:r.toString(),streamIds:n,target:e,type:i.StreamInvocation}:{arguments:t,invocationId:r.toString(),target:e,type:i.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:i.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:i.StreamItem}}_createCompletionMessage(e,t,n){return t?{error:t,invocationId:e,type:i.Completion}:{invocationId:e,result:n,type:i.Completion}}_createCloseMessage(){return{type:i.Close}}}r.Trace,r.Debug,r.Information,r.Information,r.Warning,r.Warning,r.Error,r.Critical,r.None;var H=n(21184),B=n(19186),W=n(85668);function L(){let{id:e}=(0,h.useParams)(),t=e?parseInt(e,10):null,{baseUrl:n}=(0,H.g)(),{userData:r,token:s}=(0,B.r)(),[o,i]=(0,l.useState)([]),[d,u]=(0,l.useState)(null),[g,_]=(0,l.useState)({participants:!0,messages:!0,unreadCount:!0}),[p,f]=(0,l.useState)(""),[m,b]=(0,l.useState)(null),[v,y]=(0,l.useState)(0),[w,C]=(0,l.useState)(!1),x=(0,l.useRef)(null),S=s?parseInt(r?.["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"]||"0"):0,I=(0,l.useCallback)(()=>{x.current?.scrollIntoView({behavior:"smooth"})},[]);(0,l.useCallback)(async()=>{try{if(!t||!s)return;let e=await W.A.get(`${n}/api/Chat/participants/${t}`,{headers:{Authorization:`Bearer ${s}`}});u(e.data),_(e=>({...e,participants:!1}))}catch(e){console.error("Failed to fetch participants:",e),_(e=>({...e,participants:!1}))}},[t,s,n]),(0,l.useCallback)(async()=>{try{if(!t||!s)return;let e=await W.A.get(`${n}/api/Chat/request/${t}`,{headers:{Authorization:`Bearer ${s}`}});i(e.data),_(e=>({...e,messages:!1})),I()}catch(e){console.error("Failed to fetch messages:",e),_(e=>({...e,messages:!1}))}},[t,s,n,I]),(0,l.useCallback)(async()=>{try{if(!t||!s)return;await W.A.post(`${n}/api/Chat/mark-read/${t}`,null,{headers:{Authorization:`Bearer ${s}`}}),y(0),i(e=>e.map(e=>({...e,isRead:!0})))}catch(e){console.error("Failed to mark messages as read:",e)}},[t,s,n]),(0,l.useCallback)(async()=>{try{if(!s)return;let e=await W.A.get(`${n}/api/Chat/unread-count`,{headers:{Authorization:`Bearer ${s}`}});y(e.data),_(e=>({...e,unreadCount:!1}))}catch(e){console.error("Failed to fetch unread count:",e),_(e=>({...e,unreadCount:!1}))}},[s,n]);let k=async()=>{if(!p.trim()||!d||!m||m.state!==a.Connected||w)return;let e=S===d.workerId?d.customerId:d.workerId,n={id:Date.now(),requestId:t,senderId:S,senderName:r?.name||"You",receiverId:e,receiverName:e===d.workerId?"Worker":"Customer",content:p.trim(),sentAt:new Date().toISOString(),isRead:!0};try{C(!0),i(e=>[...e,n]),f(""),I(),await m.invoke("SendMessage",t,e,p.trim())}catch(e){console.error("Error sending message:",e),i(e=>e.filter(e=>e.id!==n.id)),alert("Failed to send message. Please try again.")}finally{C(!1)}},T=g.participants||g.messages||g.unreadCount;return(0,c.jsxs)("div",{className:"max-w-3xl mx-auto p-4",children:[(0,c.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,c.jsx)("h2",{className:"text-xl font-bold",children:"Chat "}),(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[v>0&&(0,c.jsxs)("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full",children:[v," Unread"]}),(0,c.jsx)("span",{className:`text-sm ${m?.state===a.Connected?"text-green-600":"text-red-600"}`,children:m?.state===a.Connected?"connected":" disconnected "})]})]}),T?(0,c.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,c.jsx)("p",{children:"Loading data ..."})}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"h-[70vh] overflow-y-auto border rounded-lg shadow p-4 bg-gray-50",children:[0===o.length?(0,c.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,c.jsx)("p",{className:"text-gray-500",children:"No messages yet \uD83D\uDE0A"})}):o.map(e=>{let t=e.senderId===S;return(0,c.jsx)("div",{className:`flex mb-3 ${t?"justify-end":"justify-start"}`,children:(0,c.jsxs)("div",{className:`max-w-[75%] rounded-xl px-4 py-2 ${t?"bg-green-100 text-black rounded-br-none":"bg-white border text-black rounded-bl-none"}`,children:[(0,c.jsx)("div",{className:"font-semibold text-sm",children:e.senderName}),(0,c.jsx)("p",{className:"text-sm break-words",children:e.content}),(0,c.jsxs)("p",{className:"text-xs text-gray-500 text-right mt-1",children:[new Date(e.sentAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),!e.isRead&&t&&(0,c.jsx)("span",{className:"ml-1 text-blue-500",children:"•"})]})]})},e.id)}),(0,c.jsx)("div",{ref:x})]}),(0,c.jsxs)("div",{className:"flex items-center mt-4 border rounded-full px-3 py-2 shadow bg-white",children:[(0,c.jsx)("input",{type:"text",value:p,onChange:e=>f(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),k())},className:"flex-1 outline-none border-none",placeholder:"Type your message ...",disabled:!d||!m||m.state!==a.Connected||w}),(0,c.jsx)("button",{onClick:k,className:`ml-2 ${w?"text-gray-400":"text-green-600 hover:text-green-800"} disabled:opacity-50`,disabled:!p.trim()||!d||!m||m.state!==a.Connected||w,children:w?(0,c.jsxs)("svg",{className:"animate-spin h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,c.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,c.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 rotate-45",fill:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{d:"M2 21l21-9L2 3v7l15 2-15 2v7z"})})})]})]})]})}},13195:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});let r=(0,n(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\front_end\\\\projects\\\\next_js\\\\Graduation_project\\\\smart-finshing\\\\app\\\\chat\\\\[id]\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\front_end\\projects\\next_js\\Graduation_project\\smart-finshing\\app\\chat\\[id]\\page.tsx","default")},46055:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n(88077);let s=async e=>[{type:"image/x-icon",sizes:"34x33",url:(0,r.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[638,5671,8077,3051],()=>n(51238));module.exports=r})();